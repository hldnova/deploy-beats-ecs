#$DebugFile /home/admin/rsyslog.debug
#$DebugLevel 2

module(
    load="imfile"
    PollingInterval="10"
)

ruleset(name="forward") {
    action(
        type="omfwd"
        Target="{{ output.logstash_syslog.host }}"
        Port="{{ output.logstash_syslog.port }}"
        Protocol="{{ output.logstash_syslog.protocol }}"
    )
}

ruleset(name="ecs_access_logs") {
{% if output.logstash_syslog.access_legacy %}
    if ($msg contains 'RequestLog.java') then {
        call forward
        stop
   }
{% else %}
    call forward
    stop
{% endif %}
}

input(
    type="imfile" ruleset="ecs_access_logs"
{% if output.logstash_syslog.access_legacy %}
    File="{{ ecslogs.object_main_log}}/dataheadsvc.log"
{% else %}
    File="{{ ecslogs.object_main_log}}/{{ ecslogs.access_log }}"
{% endif %}
    Tag="vdc_name={{ ecs_vdc_name }}"
    Severity="{{ syslog.facility }}"
    Facility="{{ syslog.facility }}"
{% if output.logstash_syslog.access_legacy %}
    StateFile="ecs_access_legacy"
{% else %}
    StateFile="ecs_access"
{% endif %}

)
